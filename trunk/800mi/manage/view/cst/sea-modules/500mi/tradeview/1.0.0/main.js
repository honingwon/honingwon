define(function(require){require("common"),require("cart");var e=require("underscore"),t=require("$"),n='<tr class="order">	<td colspan="7">		<span>交易号：<em class="s-1"><%- purchase_id %></em></span>		<span>进货时间：<em class="s-2"><%- date %></em></span>		<span>进货金额：<em class="s-3"><%- total %></em></span>	</td></tr>',r=e.template(n),i='<tr class="item">	<td><%- goods_name %></td>	<td></td>	<td class="t-c"><%- goods_num %></td>	<td class="price"><%- purchase_price %> <s title="原价"><%- goods_price %></s></td>	<td></td>	<td class="t-r"><%- purchase_state %></td>	<td class="t-operate"></td></tr>',s=e.template(i);window.tradeView={},tradeView.closeOrder=function(e){alert(e)},t.ajax({type:"get",url:"/view/model/BMManage/PurchaseManageMethod.php",dataType:"json",data:{method:"List"},success:function(n){if(n.Success){var i=n.DataList,o=[],u,a=function(e){var t;for(var n=0;n<o.length;n++)if(e==o[n].purchase_id){t=o[n];break}return t};e.each(i,function(e){u=a(e.purchase_id);var t="未知";switch(e.purchase_state){case"0":t="提交";break;case"1":t="已付款";break;case"2":t="已发货";break;case"3":t="已收获";break;case"4":t="退货";break;case"98":t="关闭"}e.purchase_state=t;if(!u){var n=new Date;n.setTime(e.add_time*1e3),u={purchase_id:e.purchase_id,date:n.toLocaleString(),total:0,html1:"",html2:""},o.push(u)}u.total+=e.goods_num*e.purchase_price,u.html1=r(u),u.html2+=s(e)}),e.each(o,function(e){t("#orderList").append(e.html1+e.html2)})}},error:function(e){alert("链接错误")}})})