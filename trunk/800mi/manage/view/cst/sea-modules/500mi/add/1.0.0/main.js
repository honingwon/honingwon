define(function(require){function u(){var e={method:"Add",brandId:n(".searchForm select[name='brandId']").val(),type3Id:n(".searchForm select[name='type3Id']").val(),barcode:n(".searchForm input[name='barcode']").val(),name:n(".searchForm input[name='name']").val(),weight:n(".searchForm input[name='weight']").val(),stime:n(".searchForm input[name='stime']").val(),etime:n(".searchForm input[name='etime']").val(),picUrl:n(".searchForm input[name='picUrl']").val(),number:n(".searchForm input[name='number']").val(),price:n(".searchForm input[name='price']").val(),aprice:n(".searchForm input[name='aprice']").val(),remark:n(".searchForm input[name='remark']").val(),unit:n(".searchForm input[name='unit']").val()};n.ajax({type:"post",url:"/view/model/BMManage/GoodsManageMethod.php",dataType:"json",data:e,success:function(e){e.Success?alert("添加成功"):alert("添加失败")},error:function(e){alert("链接错误")}})}require("common"),require("cart"),require("ajaxfileupload");var t=require("underscore"),n=require("$"),r=require("validator"),i=new r({element:"#form"});i.addItem({element:"#brandId",required:!0,errormessageRequired:"请选择品牌"}).addItem({element:"#type3Id",required:!0,errormessageRequired:"请选择类型"}).addItem({element:"#picUrl",required:!0,errormessageRequired:"请上传图片"});var s,o;n.ajax({type:"get",url:"/view/model/BMManage/GoodsBrandManageMethod.php",dataType:"json",data:{method:"List",lv:3,type3Id:1},success:function(e){if(e.Success){o=!0;var r=n("#brandId"),i=e.DataList,s=function(e){var t='<option value="'+e.brand_id+'">'+e.brand_name+"</option>";r.append(t)};t.each(i,s)}else alert("获取品牌列表失败，请稍后重试。")},error:function(e){alert("链接错误")}}),n.ajax({type:"post",url:"/view/model/BMManage/GoodsTypeManageMethod.php",dataType:"json",data:{method:"List"},success:function(e){if(e.Success){s=!0;var r=n("#type3Id"),i=e.DataList,o=function(e){var t='<option value="'+e.type3_id+'">'+e.type3_name+"</option>";r.append(t)};t.each(i,o)}else alert("获取类型列表失败，请稍后重试。")},error:function(e){alert("链接错误")}}),n('button[type="submit"]').bind("click",function(){return!s||!o?(alert("类型列表或品牌列表未加载完成，请稍后重试。"),!1):(i.execute(function(e,t,n){e||u()}),!1)}),n("#doUpload").click(function(){return n.ajaxFileUpload({url:"doajaxfileupload.php",secureuri:!1,fileElementId:"fileToUpload",dataType:"json",success:function(e,t){typeof e.error!="undefined"&&(e.error!=""?alert(e.error):(n("#fileToUploadWrapper").html('<div style="color:green">上传成功</div>'),n("#fileToUploadWrapper").append('<img style="width:100px;height:100px;margin-top:5px" src="/view/cst/upload/'+e.filename+'"/>'),n(".searchForm input[name='picUrl']").val("/view/cst/upload/"+e.filename)))},error:function(e,t,n){alert(n)}}),!1})})