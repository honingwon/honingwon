define(function(require){var e=require("cart");console.log(e);var t=Backbone.Model.extend({defaults:function(){return{id:0,barcode:0,name:"",imgSrc:"",price:0,unitName:"",amount:1}}}),n=Backbone.Collection.extend({model:t}),r=Backbone.Model.extend({url:"./data/index.json",query:{t:(new Date).getTime()}}),i=new n,s=new r,o=Backbone.View.extend({tagName:"li",template:_.template($("#goods-template").html()),events:{"click .btn-plus":"increase","click .btn-minus":"decrease","blur input[type='text']":"setAmount","click .b-favorite":"favoriteIt","click .b-blue":"buyIt"},initialize:function(){this.listenTo(this.model,"change:amount",this.amountChanged)},amountChanged:function(){this.$input.val(this.model.get("amount"))},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$input=this.$("input[type='text']"),this},increase:function(){this.model.increase()},decrease:function(){this.model.decrease()},setAmount:function(){var e=this.$input.val();this.model.setAmount(e)},favoriteIt:function(){console.log(this.model)},buyIt:function(){if(!_.include(e.localStorage.records,this.model.id.toString()))e.create(_.clone(this.model.attributes));else{var t=e.get(this.model.id);t.setAmount(parseInt(t.get("amount"))+parseInt(this.$input.val()),!0)}}}),u=Backbone.View.extend({el:$("#market"),events:{"click #page a":"changePage"},initialize:function(){new CartView,this.listenTo(i,"add",this.addToGoodsList),this.listenTo(s,"sync",this.marketUpdate),this.getData()},changePage:function(e){console.log(e)},marketUpdate:function(e){i.set([]),i.set(e.get("goodsList"),{}),$("#page").html(e.get("page"))},addToGoodsList:function(e){var t=new o({model:e});this.$("#goods-list").append(t.render().el)},getData:function(){$("#market").addClass("loading-goods"),$("#goods-list").html(""),$("#page").html(""),s.fetch({data:s.query,success:function(e,t,n){$("#market").removeClass("loading-goods")},error:function(e,t,n){$("#market").removeClass("loading-goods")}})}}),r=new u})